function scanValue(){var n=d3.timeParse("%m/%d/%Y");data.forEach(function(t){dictClass.indexOf(t.class)<0&&dictClass.push(t.class);dictOrg.indexOf(t.org)<0&&dictOrg.push(t.org);dictOrg_type.indexOf(t.org_type)<0&&dictOrg_type.push(t.org_type);dictPclass.indexOf(t.pclass)<0&&dictPclass.push(t.pclass);dictStatus.indexOf(t.status)<0&&dictStatus.push(t.status);dictOwner.indexOf(t.owner)<0&&dictOwner.push(t.owner);dictGrant.indexOf(t.grant)<0&&dictGrant.push(t.grant);dictScheme.indexOf(t.scheme)<0&&dictScheme.push(t.scheme);t.startY=n(t.start).getFullYear();t.endY=n(t.end).getFullYear();t.startY<startFrom&&(startFrom=t.startY);t.startY>startTo&&(startTo=t.startY);t.endY<endFrom&&(endFrom=t.endY);t.endY>endTo&&(endTo=t.endY)});dictClass.sort();dictOrg.sort();dictOrg_type.sort();dictPclass.sort();dictStatus.sort();dictOwner.sort();dictGrant.sort();dictScheme.sort();initFilter(dictOwner,$("#divFilters ul[data-id='owner']"));initFilter(dictPclass,$("#divFilters ul[data-id='pclass']"));initFilter(dictOrg_type,$("#divFilters ul[data-id='org_type']"));initFilter(dictStatus,$("#divFilters ul[data-id='status']"));initFilter(dictGrant,$("#divFilters ul[data-id='grant']"))}function initFilter(n,t){var i="";n.forEach(function(n){i+="<li class='active'><span>"+(n==null||n==""?"[empty]":n)+"<\/span><a>[only]<\/a><\/li>"});t.html(i)}function refreshChart(){var n,o;if(container.selectAll("*").remove(),n=$("#divDisplayModes .btn.active").attr("data-id"),n=="trend"){drawLines();return}var s=[],t=[],i=[],u=1e6,f=0,h=n=="pclass"?dictPclass:n=="class"?dictClass:n=="org"?dictOrg:dictScheme;if(h.forEach(function(n){t[n]=0;i[n]=0}),n=="pclass"?chartData.forEach(function(n){t[n.pclass]+=parseFloat(n.total);i[n.pclass]++}):n=="class"?chartData.forEach(function(n){t[n.class]+=parseFloat(n.total);i[n.class]++}):n=="org"?chartData.forEach(function(n){t[n.org]+=parseFloat(n.total);i[n.org]++}):chartData.forEach(function(n){t[n.scheme]+=parseFloat(n.total);i[n.scheme]++}),$.each(h,function(n,r){var e=i[r];e!=0&&(s.push({id:n,name:r==null||r==""?"[empty]":r,value:t[r],records:e}),e<u&&(u=e),e>f&&(f=e))}),$("#divDisplayModes > div").show(),s.length!=0){$("#spanRecords").html(u+" - "+f);var e=Math.min($container.width(),$container.height()),c=d3.scaleLinear().domain([Math.sqrt(u),Math.sqrt(f)]).interpolate(d3.interpolateHslLong).range(["#007DB4","#FFA600"]),l=d3.pack().size([e,e]).padding(1),a=d3.hierarchy({children:s}).sum(function(n){return n.value}),v=container.append("svg").attr("width",e).attr("height",e).attr("class","bubble"),r=v.selectAll(".node").data(l(a).leaves()).enter().append("g").attr("class","node").attr("opacity",0).attr("transform",function(n){return"translate("+n.x+","+n.y+")"});r.append("circle").attr("id",function(n){return"node"+n.data.id}).attr("r",function(n){return n.r}).style("fill",function(n){return c(Math.sqrt(n.data.records))});r.append("clipPath").attr("id",function(n){return"clip"+n.data.id}).append("use").attr("xlink:href",function(n){return"#node"+n.data.id});r.append("text").attr("clip-path",function(n){return"url(#clip"+n.data.id+")"}).selectAll("tspan").data(function(n){return n.data.name.split(/(?=[A-Z][^A-Z])/g)}).enter().append("tspan").attr("x",0).attr("y",function(n,t,i){return 13+(t-i.length/2-.5)*10}).text(function(n){return n});o=container.append("div").attr("class","tooltip").attr("style","display: none;");r.on("mouseover",function(n){var t=d3.mouse(container.node());o.html("<label>"+n.data.name+"<\/label><br/>Number of records: "+n.data.records+"<br/>Total grant value: "+d3.format(",.2f")(n.data.value)).style("left",t[0]+20+"px").style("top",t[1]-10+"px").style("display","inline")}).on("mouseout",function(){o.style("display","none")}).on("mousemove",function(){var n=d3.mouse(container.node());o.style("left",n[0]+20+"px").style("top",n[1]-10+"px")});r.transition().duration(1e3).attr("opacity",1)}}function drawLines(){var t=[],i=[],r=[],l,u,v,c,o;if(dictPclass.forEach(function(n){i[n]=[];r[n]=[]}),chartData.forEach(function(n){i[n.pclass][n.startY]==null?(i[n.pclass][n.startY]=parseFloat(n.total),r[n.pclass][n.startY]=1):(i[n.pclass][n.startY]+=parseFloat(n.total),r[n.pclass][n.startY]++)}),l=Math.min(startTo,(new Date).getFullYear()),$.each(dictPclass,function(n,u){var o=r[u],e,f;if(o.length!=0){for(e={id:n,name:u==null||u==""?"[empty]":u,years:[]},f=startFrom;f<=l;f++)i[u][f]!=null&&e.years.push({year:f,value:i[u][f],records:r[u][f]});t.push(e)}}),$("#divDisplayModes > div").hide(),t.length!=0){var n={top:50,right:50,bottom:80,left:60},f=$container.width()-n.left-n.right,s=$container.height()-n.top-n.bottom,a=d3.scaleOrdinal(d3.schemeCategory20),e=d3.scaleLinear().range([0,f]),h=d3.scaleLinear().range([s,0]),y=d3.line().x(function(n){return e(n.year)}).y(function(n){return h(n.records)});e.domain([d3.min(t,function(n){return d3.min(n.years,function(n){return n.year})}),d3.max(t,function(n){return d3.max(n.years,function(n){return n.year})})]);h.domain([d3.min(t,function(n){return d3.min(n.years,function(n){return n.records})}),d3.max(t,function(n){return d3.max(n.years,function(n){return n.records})})]);u=container.append("svg").attr("width",$container.width()).attr("height",$container.height()).append("g").attr("transform","translate("+n.left+","+n.top+")");u.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+s+")").call(d3.axisBottom(e)).append("text").attr("x",n.left+f/2-40).attr("y",40).attr("fill","#000").text("Year of start date");u.append("g").attr("class","axis axis--y").call(d3.axisLeft(h)).append("text").attr("transform","rotate(-90)").attr("y",-40).attr("fill","#000").text("Number of records");v=u.selectAll(".line").data(t).enter().append("g").attr("class","line");v.append("path").attr("d",function(n){return y(n.years)}).style("stroke",function(n){return a(n.name)});c=container.append("div").attr("class","vertical").style("height",s+"px").style("top",n.top+"px").style("left",n.left+"px");o=container.append("div").attr("class","tooltip").attr("style","display: none; width: 200px;");container.select("svg").on("mousemove",function(){var i=d3.mouse(u.node())[0],s,r;if(i<0||i>f){c.style("display","none");o.style("display","none");return}c.style("display","inline").style("left",i+n.left+"px");s=Math.round(e.invert(i));r="<label>"+s+"<\/label>";t.forEach(function(n){n.years.forEach(function(t){t.year==s&&(r+="<br/><span style='color: "+a(n.name)+"'>"+n.name+": "+t.records+"<\/span>")})});f-i<220?o.html(r).style("left",i+n.left-230+"px").style("top",n.top+"px").style("display","inline"):o.html(r).style("left",i+n.left+10+"px").style("top",n.top+"px").style("display","inline")})}}function refreshFilter(){var t=$("#divFilters ul[data-id='owner']").find("li.active > span").map(function(){return $(this).text()}).get(),n=$("#divFilters ul[data-id='pclass']").find("li.active > span").map(function(){return $(this).text()}).get(),i=$("#divFilters ul[data-id='org_type']").find("li.active > span").map(function(){return $(this).text()}).get(),r=$("#divFilters ul[data-id='status']").find("li.active > span").map(function(){return $(this).text()}).get(),u=$("#divFilters ul[data-id='grant']").find("li.active > span").map(function(){return $(this).text()}).get(),f;n.indexOf("[empty]")>=0&&(f=n.indexOf("[empty]"),n[f]="");chartData=[];var e=t.length==dictOwner.length,o=n.length==dictPclass.length,s=i.length==dictOrg_type.length,h=r.length==dictStatus.length,c=u.length==dictGrant.length;data.forEach(function(f){!e&&t.indexOf(f.owner)<0||!o&&n.indexOf(f.pclass)<0||!s&&i.indexOf(f.org_type)<0||!h&&r.indexOf(f.status)<0||!c&&u.indexOf(f.grant)<0||chartData.push(f)});refreshChart()}var container=d3.select("#divContainer"),$container=$("#divContainer"),data,chartData,dictClass=[],dictOrg=[],dictOrg_type=[],dictPclass=[],dictStatus=[],dictOwner=[],dictGrant=[],dictScheme=[],startFrom=1e6,startTo=0,endFrom=1e6,endTo=0;$(document).ready(function(){$("#divDisplayModes .btn").click(function(){$("#divDisplayModes .btn.active").removeClass("active");$(this).addClass("active");refreshChart()});$("#divFilters ul").on("click","a",function(){return $(this).closest("ul").find("li.active").removeClass("active"),$(this).parent().addClass("active"),refreshFilter(),!1});$("#divFilters ul").on("click","li",function(){return $(this).toggleClass("active"),refreshFilter(),!1});$("#divFilters label").on("click","a",function(){return $(this).parent().next().find("li").addClass("active"),refreshFilter(),!1});d3.csv("data/PhysicsFunding.csv",function(n){data=n;chartData=n;scanValue();$("#divDisplayModes .btn").first().click()})});
/*
//# sourceMappingURL=index3.min.js.map
*/